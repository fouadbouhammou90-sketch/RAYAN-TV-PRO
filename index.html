<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#fff">
  <title>RAYAN TV</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
       <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
         <meta http-equiv="X-UA-Compatible" content="IE=edge">
           <meta name="author" content="rayan tv"> <!-- اسم المؤلف -->
             <meta name="description" content="مشاهدة القنوات، بث مباشر، قنوات العالم، قنوات فضائية، الأفلام، المسلسلات، أفلام جديدة، مسلسلات عربية، مسلسلات أجنبية، قنوات رياضية، قنوات إخبارية، قنوات ترفيهية، مشاهدة مباشرة، أفضل القنوات، أحدث الأفلام، بث القنوات العالمية، مسلسلات حصرية, Watch channels, live streaming, world channels, satellite channels, movies, series, new movies, Arabic series, foreign series, sports channels, news channels, entertainment channels, live watching, best channels, latest movies, global channels streaming, exclusive series, Regarder des chaînes, streaming en direct, chaînes mondiales, chaînes satellites, films, séries, nouveaux films, séries arabes, séries étrangères, chaînes sportives, chaînes d'actualités, chaînes de divertissement, visionnage en direct, meilleures chaînes, derniers films, diffusion mondiale, séries exclusives">
                 <meta name="keywords" content="HTML, meta, تحسين محركات البحث, SEO, مثال">
                     <meta name="theme-color" content="#BE4A4A">
   <meta charset="UTF-8"> <!-- تحديد الترميز -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- توافق الصفحة مع جميع الأجهزة -->
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <meta name="description" content="هذا مثال لصفحة تحتوي على جميع أكواد meta.">
  <meta name="author" content="Rayan bhm">
      <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">
    <meta property="og:title" content="rayan tv">
  <meta property="og:description" content="وصف موجز عن الصفحة يظهر عند مشاركتها.">
    <meta property="og:image" content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjxlegowTV89qwUU7M4lVGBnIimwC_NZNRPnOXiO5-NC4uwRGL-iRM-83pH3w38eSASAbtgllAJ6sRp9dc860OCI0eElbhp2poE1tBafj00AloDlXUxDWOHdC96naxNnoowvcyiVUxhxsaIzPVPlwCEr33OZ5IaGgl_gFlnZRxX6Af3bSXCDqwVtkzgN4c/s320/S5.png">
      <meta property="og:url" content="https://example.com">
        <meta property="og:type" content="website">
  <meta property="og:locale" content="ar_AR">
    <!-- تحسين المشاركة على Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="عنوان الصفحة على تويتر">
  <meta name="twitter:description" content="وصف الصفحة عند مشاركتها على تويتر.">
  <meta name="twitter:image" content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjxlegowTV89qwUU7M4lVGBnIimwC_NZNRPnOXiO5-NC4uwRGL-iRM-83pH3w38eSASAbtgllAJ6sRp9dc860OCI0eElbhp2poE1tBafj00AloDlXUxDWOHdC96naxNnoowvcyiVUxhxsaIzPVPlwCEr33OZ5IaGgl_gFlnZRxX6Af3bSXCDqwVtkzgN4c/s320/S5.png">
    <meta name="twitter:site" content="@YourTwitterHandle">
      <!-- التحكم بالمتصفح والأنماط -->
 
  <meta name="theme-color" content="#007BFF">
  <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
<meta name="permissions-policy" content="geolocation=(self), microphone=(), camera=(), fullscreen=*">
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta name="permissions-policy" content="geolocation=(self)">

  <!-- تحسينات إضافية -->
  <meta name="generator" content="اسم الأداة المستخدمة لإنشاء الصفحة">
  <meta name="rating" content="general">
  <meta name="distribution" content="global">
  <meta name="language" content="ar">
  <meta name="revisit-after" content="7 days">

  <!-- دعم PWA (تطبيقات الويب التقدمية) -->
  <meta name="application-name" content="rayan tv">
  <meta name="apple-mobile-web-app-title" content="rayan tv">
  <meta name="msapplication-TileColor" content="#007BFF">
  <meta name="msapplication-TileImage" content="https://example.com/tile.png">
  <meta name="msapplication-config" content="browserconfig.xml">
  <link rel="manifest" href="manifest.json">
<script src="Morocco.js"></script>
  <!-- Favicon -->
  <link rel="icon" href="https://example.com/favicon.ico" type="image/x-icon">

  <style>
    /* --- إعدادات عامة --- */
    html, body {
        box-sizing: border-box;
           -webkit-user-select: none; /* Chrome, Safari, Opera */
            -moz-user-select: none;    /* Firefox */
            -ms-user-select: none;     /* Internet Explorer/Edge */
            user-select: none;         /* Non-prefixed version */

    /* Header style */
      -webkit-user-select: none;
      user-select: none;
      /* الخلفية الأساسية - يتم تبديلها بواسطة JS */
      background: var(--bg-color, #f4f6f8); 
      color: var(--text-color, #9D0F0F); 
      font-family: "Amiri", "Arial", sans-serif; /* Use an Arabic-friendly font */
      margin: 0;
      padding: 0;
      text-align: center;
      overflow-x: hidden;
      transition: background 0.3s, color 0.3s;
    }

    /* --- وضع الليل (Dark Mode) --- */
    body.dark-mode {
        --bg-color: #1a1a2e; /* خلفية داكنة */
        --text-color: #ecf0f1; /* نص فاتح */
        --card-bg: #2c3e50; /* خلفية عناصر داكنة */
        --card-shadow: 0 2px 8px rgba(255,255,255,0.05);
        --border-color: #34495e;
        --header-color: #16213e; /* هيدر أغمق */
    }

    /* --- الوضع العادي (Light Mode) --- */
    body:not(.dark-mode) {
        --bg-color: #f4f6f8;
        --text-color: #000000;
        --card-bg: #fff;
        --card-shadow: 0 2px 8px rgba(0,0,0,0.05);
        --border-color: #0005C6;
        --header-color: #0095B7;
    }

    /* --- الهيدر (القائمة العلوية) --- */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 55px;
      background-color: var(--header-color); /* أزرق داكن جميل */
      border-bottom: 1px solid var(--border-color); /* لون داكن للفاصل */
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      box-sizing: border-box;
   color: #fff;
    }

    /* عناصر الهيدر العادية */
    .header-normal {
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: space-between;
    }

    /* حاوية الأزرار على اليمين */
    .header-actions {
        display: flex;
        gap: 6px;
    }

    .header .title {
      font-size: 17px;
      font-weight: 200;
      color: #ecf0f1; /* نص فاتح ليظهر على الخلفية الداكنة */
      flex-grow: 8;
      text-align: left;
    }

    .header button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      /* لجعل الأيقونات فاتحة */
      filter: invert(1);
    }

    .header img {
      width: 24px;
      height: 24px;
    }

    /* --- مربع البحث في الهيدر --- */
    .search-bar-container {
        display: none;
        width: 100%;
        align-items: center;
        gap: 10px;
    }

    .search-input {
        flex-grow: 1;
        padding: 8px 12px;
        border-radius: 20px;
        border: 1px solid #ddd;
        background: #f9f9f9;
        font-size: 14px;
        outline: none;
        text-align: right;
        color: #333; /* لضمان رؤية النص في وضع الليل */
    }

    .search-input:focus {
        border-color: #e74c3c; 
        background: #fff;
    }

    /* --- المحتوى الرئيسي --- */
    .main {
      margin-top: 130px;
      margin-bottom: 80px;
      padding: 10px;
      min-height: 80vh;
    }

    /* --- الأقسام (Categories) --- */
    .categories-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
    }

    .category-item {
      background: var(--card-bg);
      color: var(--text-color);
      padding: 17px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--card-shadow);
      transition: all 0.2s ease;
      text-align: center;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--border-color);
    }

    .category-item:hover {
      background-color: var(--bg-color); /* لون الخلفية عند التحويم */
      transform: translateY(-2px);
      border-color: #e74c3c; 
    }

    .cat-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .cat-count {
        background-color: #fce4e1; 
        color: #e74c3c; 
        font-size: 16px;
        font-weight: 700;
        padding: 3px 8px;
        border-radius: 20px;
        border: 1px solid #e74c3c; 
    }
    
    body.dark-mode .cat-count {
        background-color: #e74c3c;
        color: #fff;
    }

    .category-item::after {
      content: '›';
      font-size: 22px;
      color: var(--border-color);
    }

    /* --- شبكة المحتوى وزر المفضلة --- */
    .content-container {
      display: none;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
    }

    .content-item {
      position: relative;
      width: 110px;
      height: 165px;
      background-color: var(--card-bg);
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      cursor: pointer;
      border: 1px solid var(--border-color);
      transition: transform 0.2s;
      padding: 5px;
      padding-top: 10px;
    }

    .content-item:hover {
      transform: scale(1.03);
      border-color: #e74c3c; 
    }

    .content-item img {
      width: 90px;
      height: 105px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    .content-item.is-channel img {
        object-fit: contain;
        height: 60px;
        width: 70px;
        margin-top: 20px;
    }

    .content-item span {
      display: block;
      font-size: 11px;
      color: var(--text-color);
      text-align: center;
      line-height: 1.3;
      max-height: 32px;
      overflow: hidden;
      width: 100%;
      font-weight: 500;
    }

    /* --- زر المفضلة (القلب) --- */
    .fav-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
        color: #ccc;
        z-index: 10;
        transition: all 0.2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    body.dark-mode .fav-btn {
        box-shadow: 0 2px 4px rgba(255,255,255,0.1);
    }

    .fav-btn.active {
        color: #e74c3c; 
        border-color: #e74c3c;
    }
    
    .fav-btn:hover {
        transform: scale(1.1);
    }

    /* فواصل العناوين في صفحة المفضلة */
    .section-separator {
        width: 100%;
        text-align: left;
        margin: 15px 0 5px 0;
        padding-bottom: 5px;
        border-bottom: 1px solid #e74c3c;
        font-weight: 700;
        color: #e74c3c; 
        padding-left: 10px;
    }

    /* --- الحلقات --- */
    .episodes-container {
        display: none;
        flex-direction: column;
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        gap: 10px;
    }

    .season-header {
        text-align: left;
        font-size: 18px;
        font-weight: 700;
        color: var(--text-color);
        margin-top: 20px;
        margin-bottom: 10px;
        border-bottom: 2px solid #e74c3c; 
        padding-bottom: 5px;
        width: 100%;
    }

    .episode-item {
        background: var(--card-bg);
        padding: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        cursor: pointer;
        border: 1px solid var(--border-color);
        transition: background 0.2s;
        text-align: left;
    }

    .episode-item:hover { background-color: var(--bg-color); }

    .play-icon {
        width: 30px;
        height: 30px;
        background: #e74c3c; 
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .play-icon::after { content: '▶'; color: #fff; font-size: 12px; margin-left: 2px; }

    .episode-info { flex-grow: 1; }
    .episode-title { font-size: 14px; font-weight: 600; color: var(--text-color); margin-bottom: 4px; }
    .episode-meta { font-size: 11px; color: #888; }
    
    body.dark-mode .episode-meta { color: #a0a0a0; }


    /* --- المشغل --- */
    .player-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      z-index: 2000;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .player-overlay video { width: 100%; max-height: 100%; outline: none; }

    .close-player-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      cursor: pointer;
      z-index: 2001;
    }

    .loading-msg {
      margin-top: 50px;
      color: var(--text-color);
      font-size: 14px;
      display: none;
    }

    /* --- القائمة السفلية (Bottom Navigation) --- */
    .bottom-nav {
      position: fixed;
      top: 54px;
      left: 0;
      width: 100%;
      height: 65px;
      background-color: var(--header-color); 
      border-top: 1px solid #34495e; 
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      padding-bottom: 5px;
    }

    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 14px;
      color: #FFFFFF; 
      cursor: pointer;
      width: 20%;
      transition: color 0.2s;
    }

    .bottom-nav-item.active { 
      color: #e74c3c; 
      font-weight: 600; 
    }

    .bottom-nav-item img {
      width: 23px;
      height: 23px;
      margin-bottom: 5px;
      filter: invert(1) grayscale(100%); 
      opacity: 0.7;
      transition: all 0.2s;
    }

    .bottom-nav-item.active img { 
      filter: invert(1); 
      opacity: 1; 
      transform: scale(1.1); 
    }
    span i{
        position: relative;
            right: 0;
            font-size: 24px;
            cursor: pointer;
            color: #FFFFFF;
      top: 0;
      margin: 1px;
      filter: invert(1) grayscale(100%); 
      opacity: 0.7;
      transition: all 0.2s;
    }
      .sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            top: 0;
            right: 0;
            background-color: #fff;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 0px;
            z-index: 1009;
        }
.sidebar .close-btn {
  position: absolute;
  top: 10px;
  left: 5px;
  font-size: 29px;
  color: white;
  cursor: pointer;
  width: 40px;
  height: 40px;
  background: linear-gradient(45deg, #ff4b2b, #ff416c);
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s, box-shadow 0.3s;
}

.sidebar .close-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
  background: linear-gradient(45deg, #ff416c, #ff4b2b);
}
        .sidebar.open {
            right: 5px;
        }

        .sidebar .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            padding: 0;
            margin: 0;
            background-color: #D3C566;
            border-bottom: 1px solid #ccc;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .sidebar ul li {
            position: relative;
            top: 0;
            border-bottom: 1px solid #8bf4ff;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
        }

        .sidebar ul li a {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin: 0px;
            padding: 0px;
            width: 100%;
            font-size: 10px;
            text-decoration: none;
            color: #111;
        }
.sidebar ul li a i{
  margin:5px;
  padding:5px;
  font-size:22px;
 color: #FF0000;
}
        .sidebar ul li a:hover {
            background: #ccc;
            color: #007d92;
        }
        
        .sidebar .close-btn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-right: 50px;
        }
        .overlay {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1001;
            cursor: pointer;
        }
        footer {
  display: flex;
  justify-content: center;
  align-items: center;
    position: absolute; /* يثبت العنصر في مكانه */
    bottom: 0; /* يجعله في أسفل الصفحة */
    left: 0;
    width: 100%;
    height: 30px;
    /* يمتد على عرض الصفحة بالكامل */
    text-align: center; /* يضع النصوص في المنتصف */
    padding: 7px; /* مساحة داخلية للفوتر */
    font-size: 12px;
    background-color: rgba(0, 0, 0, 0.8); /* لون خلفية شفاف */
    color: #ffffffcc; /* لون النص */
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2); /* ظل خفيف للفوتر */
    z-index: 1000; /* للتأكد من ظهوره فوق العناصر الأخرى */
}

.sidebar footer span {
    color: #0094f3; /* لون مميز للنص داخل الفوتر */
}
 .alert {
      position: fixed;
top: 40px;
left:0;
width: 100%;
z-index: 20;
background-color: #f8d7da;
color: #721c24;
padding: 5px;
margin: 0;
border: 1px solid #f5c6cb;
border-radius: 2px;
display: none;
justify-content: center;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-normal" id="headerNormal">
        <div class="header-actions">
            <button class="back-button" id="back-button" onclick="handleBackButton()" style="display: none;">
                <img src="https://cdn-icons-png.flaticon.com/128/507/507257.png" alt="Back" />
            </button>
        </div>
        <div class="title" id="header-title">RAYAN TV</div>
                    <button class="reload-button" onclick="reloadPage()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Refresh_icon.svg/768px-Refresh_icon.svg.png" alt="Reload" />
            </button>
        <div class="header-actions">
             <button class="mode-toggle" id="mode-toggle" onclick="toggleDarkMode()">
                <img id="mode-icon" src="https://static.thenounproject.com/png/4066357-200.png" alt="Dark Mode" />
            </button>
            <button class="search" onclick="toggleSearch(true)">
                <img src="https://cdn-icons-png.flaticon.com/128/10385/10385257.png" alt="Search" />
            </button>
            <div class="header-actions" onclick="openNav()">
     <span class="menu-icon" onclick="openNav()"><i>&#9776</i></span>
    </div>
        </div>
        </div>

    <div class="search-bar-container" id="searchContainer">
        <button onclick="toggleSearch(false)">✕</button>
        <input type="text" id="searchInput" class="search-input" placeholder="ابحث هنا..." onkeyup="handleSearch()">
    </div>
  </div>

  <div class="main">
    <div id="loading" class="loading-msg">جاري التحميل...</div>
    <div class="categories-container" id="categories"></div>
    <div class="content-container" id="content-list"></div>
    <div class="episodes-container" id="episodes-list"></div>
  </div>

  <div class="player-overlay" id="playerOverlay">
    <button class="close-player-btn" onclick="closePlayer()">✕</button>
    <video id="videoPlayer" controls autoplay playsinline></video>
  </div>

  <div class="bottom-nav">
    <div class="bottom-nav-item active" id="nav-live" onclick="switchMode('live')">
      <img src="https://cdn-icons-png.flaticon.com/128/167/167018.png" alt="Live">
      <span>القنوات</span>
    </div>
    <div class="bottom-nav-item" id="nav-movie" onclick="switchMode('movie')">
      <img src="https://cdn-icons-png.flaticon.com/128/4240/4240150.png" alt="Movies">
      <span>الأفلام</span>
    </div>
    <div class="bottom-nav-item" id="nav-series" onclick="switchMode('series')">
      <img src="https://cdn-icons-png.flaticon.com/128/11451/11451050.png" alt="Series">
      <span>المسلسلات</span>
    </div>
         <div class="bottom-nav-item" id="nav-favorites" onclick="switchMode('favorites')">
      <img src="https://cdn-icons-png.flaticon.com/512/7245/7245022.png" alt="Favorites">
      <span>المفضلة</span>
    </div>
  </div>
    
 <div class="sidebar" id="mySidebar">
        <div class="logo">

            <h2>RAYAN TV</h2>
        </div>
<ul>

    <li><a href="#"><i style="color:lightblue" class="fa-solid fa-earth"></i><h3> Website</h3></a></li>
    <li><a href="#"><i style="color: #3b5998;" class="fab fa-facebook"></i><h3> Facebook</h3></a></li>
    <li><a href="#"><i style="color: #25D366" class="fab fa-whatsapp"></i><h3> WhatsApp</h3></a></li>
    <li><a href="#"><i class="fab fa-youtube"></i><h3> YouTube</h3></a></li>
    <li><a href="#"><i style="color: #111111;
  filter: drop-shadow(-1px -1px 0 #24f6f0) contrast(120%) brightness(100%);
  z-index: -1;" class="fab fa-tiktok"></i><h3> TikTok</h3></a></li>
    <li><a href="#"><i style="color:#229ED9" class="fab fa-telegram"></i><h3> Telegram</h3></a></li>
    <li id="shareButton"><a href="#"><i class="fas fa-share-alt"></i><h3> Share Apps</h3></a></li>
    <li><a href="#"><i class="fa-solid fa-envelope"></i><h3> Contact</h3></a></li>
    <!-- رابط شروط الاستخدام -->
    <li>
        <a href="terms.html">
            <i class="fa-solid fa-file-contract"></i>
            <h3> شروط الاستخدام</h3>
        </a>
    </li>
    
    <!-- رابط سياسة الخصوصية -->
    <li>
        <a href="privacy.html">
            <i class="fa-solid fa-shield"></i>
            <h3>سياسة الخصوصية </h3>
        </a>
    </li>
</ul>
<footer>
    <p><span></span>&copy;2025 جميع الحقوق محفوظة</p>
</footer>
    </div>

<div id="myOverlay" class="overlay" onclick="closeNav()"></div>
  <script>
    // --- إعدادات السيرفر (لم يتم تغييرها) ---
    const API_URL = 'HTTPS://cdnplus-ott.tv';
    const USERNAME = '65787';
    const PASSWORD = '54353';

    // --- إدارة المفضلة (LocalStorage) ---
    function getFavorites() {
        const stored = localStorage.getItem('rayan_favs_v2');
        return stored ? JSON.parse(stored) : { live: [], movie: [], series: [] };
    }

    function saveFavorite(item, type) {
        const favs = getFavorites();
        if (!favs[type].some(f => (type === 'series' ? f.series_id === item.series_id : f.stream_id === item.stream_id))) {
            favs[type].push(item);
            localStorage.setItem('rayan_favs_v2', JSON.stringify(favs));
        }
    }

    function removeFavorite(id, type) {
        const favs = getFavorites();
        favs[type] = favs[type].filter(f => (type === 'series' ? f.series_id != id : f.stream_id != id));
        localStorage.setItem('rayan_favs_v2', JSON.stringify(favs));
    }

    function isFavorite(id, type) {
        const favs = getFavorites();
        return favs[type].some(f => (type === 'series' ? f.series_id == id : f.stream_id == id));
    }

    function toggleFavorite(event, item, type) {
        event.stopPropagation();
        
        const id = type === 'series' ? item.series_id : item.stream_id;
        const btn = event.currentTarget;
        
        if (isFavorite(id, type)) {
            removeFavorite(id, type);
            btn.classList.remove('active');
            btn.innerHTML = '♥';
            
            if(currentMode === 'favorites') {
                btn.parentElement.remove();
                if(contentDiv.children.length === 0) contentDiv.innerHTML = '<p>المفضلة فارغة</p>';
            }
        } else {
            saveFavorite(item, type);
            btn.classList.add('active');
        }
    }

    // --- متغيرات الحالة (لم يتم تغييرها) ---
    let currentMode = 'live'; 
    let currentView = 'categories'; 
    let lastCategoryName = ''; 
    let hls = null;
    
    let allDataCache = { live: [], movie: [], series: [] };
    let categoryCounts = { live: {}, movie: {}, series: {} };
    let isDataLoaded = { live: false, movie: false, series: false };

    // عناصر الصفحة
    const body = document.body;
    const categoriesDiv = document.getElementById('categories');
    const contentDiv = document.getElementById('content-list');
    const episodesDiv = document.getElementById('episodes-list');
    const titleDiv = document.getElementById('header-title');
    const backBtn = document.getElementById('back-button');
    const loadingDiv = document.getElementById('loading');
    const playerOverlay = document.getElementById('playerOverlay');
    const videoPlayer = document.getElementById('videoPlayer');
    
    const headerNormal = document.getElementById('headerNormal');
    const searchContainer = document.getElementById('searchContainer');
    const searchInput = document.getElementById('searchInput');
    const modeIcon = document.getElementById('mode-icon');
    

    function cleanName(originalName) {
        if (!originalName) return "No Name";
        let newName = originalName;
        newName = newName.replace(/\|AR\||\|FR\||\[HD\]|\|HD\||\(BACKUP\)/g, "",);
        newName = newName.replace(/_/g, " ");
        return newName.trim();
    }

    // --- وظائف جديدة: إعادة التحميل وتغيير الوضع ---
    function reloadPage() {
        // يمكن استخدام window.location.reload() لتحميل الصفحة بالكامل
        // لكن هنا سنعيد تشغيل الوضع الحالي لجلب البيانات من جديد
        isDataLoaded = { live: false, movie: false, series: false }; // مسح الكاش
        switchMode(currentMode);
    }

    function toggleDarkMode() {
        body.classList.toggle('dark-mode');
        const isDarkMode = body.classList.contains('dark-mode');
        
        // تحديث أيقونة الوضع وتخزين التفضيل
        if (isDarkMode) {
            modeIcon.src = "https://static.thenounproject.com/png/4066357-200.png"; // أيقونة الشمس (للتغيير إلى فاتح)
            localStorage.setItem('rayan_mode', 'dark');
        } else {
            modeIcon.src = "https://static.thenounproject.com/png/4066357-200.png"; // أيقونة القمر (للتغيير إلى داكن)
            localStorage.setItem('rayan_mode', 'light');
        }
    }

    function applySavedMode() {
        const savedMode = localStorage.getItem('rayan_mode');
        if (savedMode === 'dark') {
            body.classList.add('dark-mode');
            modeIcon.src = "https://static.thenounproject.com/png/4066357-200.png"; 
        } else {
             modeIcon.src = "https://static.thenounproject.com/png/4066357-200.png";
        }
    }
    // ----------------------------------------------


    // --- وظائف البحث (لم يتم تغييرها) ---
    function toggleSearch(show) {
        if (show) {
            headerNormal.style.display = 'none';
            searchContainer.style.display = 'flex';
            searchInput.focus();
            categoriesDiv.style.display = 'none';
            contentDiv.style.display = 'flex';
            episodesDiv.style.display = 'none';
            contentDiv.innerHTML = '<p style="width:100%; margin-top:20px; color:#999;">اكتب للبحث...</p>';
            currentView = 'search';
        } else {
            headerNormal.style.display = 'flex';
            searchContainer.style.display = 'none';
            searchInput.value = '';
            if (currentMode === 'favorites') showFavoritesView();
            else resetToCategories();
        }
    }

    function handleSearch() {
        const query = searchInput.value.toLowerCase();
        
        let dataList = [];
        if (currentMode === 'favorites') {
             const favs = getFavorites();
             dataList = [...favs.live, ...favs.movie, ...favs.series];
        } else {
             dataList = allDataCache[currentMode];
        }
        
        if (!dataList || dataList.length === 0) {
            contentDiv.innerHTML = '<p>لا توجد بيانات للبحث</p>';
            return;
        }

        if (query.length < 2) {
            contentDiv.innerHTML = '<p style="width:100%; margin-top:20px; color:#999;">أدخل حرفين على الأقل</p>';
            return;
        }

        const results = dataList.filter(item => {
            const name = (item.name || "").toLowerCase();
            return name.includes(query);
        });

        contentDiv.innerHTML = '';
        if (results.length > 0) {
            results.slice(0, 50).forEach(item => {
                let type = currentMode;
                if(currentMode === 'favorites') {
                    if(item.series_id) type = 'series';
                    else if(item.container_extension) type = 'movie';
                    else type = 'live';
                }
                createContentItem(item, type);
            });
        } else {
            contentDiv.innerHTML = '<p style="width:100%; margin-top:20px;">لا توجد نتائج</p>';
        }
    }

    // --- إنشاء عنصر المحتوى ---
    function createContentItem(item, explicitMode = null) {
        const mode = explicitMode || currentMode;

        const el = document.createElement('div');
        el.className = mode === 'live' ? 'content-item is-channel' : 'content-item';

        let name, icon, id, ext;
        if (mode === 'series') {
            name = item.name;
            icon = item.cover ? item.cover : 'https://cdn-icons-png.flaticon.com/128/3163/3163508.png';
            id = item.series_id;
        } else {
            name = item.name;
            icon = item.stream_icon ? item.stream_icon : 'https://cdn-icons-png.flaticon.com/128/777/777242.png';
            id = item.stream_id;
            ext = item.container_extension;
        }
        
        const isFav = isFavorite(id, mode);
        const favClass = isFav ? 'active' : '';

        el.innerHTML = `
            <button class="fav-btn ${favClass}">♥</button>
            <img src="${icon}" alt="${cleanName(name)}" onerror="this.src='https://cdn-icons-png.flaticon.com/128/4240/4240150.png'">
            <span>${cleanName(name)}</span>
        `;

        const favBtn = el.querySelector('.fav-btn');
        favBtn.onclick = (e) => toggleFavorite(e, item, mode);

        if (mode === 'series') {
            el.onclick = () => {
                if(currentView === 'search') {
                    headerNormal.style.display = 'flex';
                    searchContainer.style.display = 'none';
                }
                fetchSeriesEpisodes(id, name);
            };
        } else {
            el.onclick = () => openPlayer(id, ext, mode);
        }
        contentDiv.appendChild(el);
    }

    // --- التبديل بين الأوضاع ---
    function switchMode(mode) {
        if (currentMode === mode && currentView === 'categories' && mode !== 'favorites' && isDataLoaded[mode]) return;
        
        if (currentView === 'search') toggleSearch(false);

        currentMode = mode;
        
        document.querySelectorAll('.bottom-nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById(`nav-${mode}`).classList.add('active');

        if (mode === 'favorites') {
            showFavoritesView();
        } else {
            resetToCategories();
            
            if(mode === 'live') titleDiv.textContent = 'RAYAN TV PRO';
            else if(mode === 'movie') titleDiv.textContent = 'RAYAN TV PRO';
            else if(mode === 'series') titleDiv.textContent = 'RAYAN TV PRO';

            fetchCategories();
        }
    }

    // --- عرض صفحة المفضلة ---
    function showFavoritesView() {
        categoriesDiv.style.display = 'none';
        contentDiv.style.display = 'flex';
        episodesDiv.style.display = 'none';
        backBtn.style.display = 'none';
        currentView = 'list';
        titleDiv.textContent = 'FAVORITES';

        const favs = getFavorites();
        contentDiv.innerHTML = '';

        let hasData = false;

        if (favs.live.length > 0) {
            hasData = true;
            contentDiv.innerHTML += '<div class="section-separator">Live Channels</div>';
            favs.live.forEach(item => createContentItem(item, 'live'));
        }

        if (favs.movie.length > 0) {
            hasData = true;
            contentDiv.innerHTML += '<div class="section-separator" style="margin-top:20px;">Movies</div>';
            favs.movie.forEach(item => createContentItem(item, 'movie'));
        }

        if (favs.series.length > 0) {
            hasData = true;
            contentDiv.innerHTML += '<div class="section-separator" style="margin-top:20px;">Series</div>';
            favs.series.forEach(item => createContentItem(item, 'series'));
        }

        if (!hasData) {
            contentDiv.innerHTML = '<div style="margin-top:50px; color:#999;">لم تقم بإضافة أي مفضلة بعد.<br>اضغط على القلب ♥ للإضافة.</div>';
        }
    }

    // --- وظائف التنقل (لم يتم تغييرها) ---
    function handleBackButton() {
        if (currentView === 'episodes') {
            episodesDiv.style.display = 'none';
            contentDiv.style.display = 'flex';
            currentView = 'list';
            titleDiv.textContent = lastCategoryName || 'FAVORITES'; 
        } else if (currentView === 'list') {
            if (currentMode !== 'favorites') {
                resetToCategories();
            }
        }
    }

    function resetToCategories() {
        categoriesDiv.style.display = 'flex';
        contentDiv.style.display = 'none';
        episodesDiv.style.display = 'none';
        backBtn.style.display = 'none';
        currentView = 'categories';
    }

    // --- جلب البيانات ---
    async function fetchCategories() {
        if (currentMode === 'favorites') return;

        loadingDiv.style.display = 'block';
        categoriesDiv.innerHTML = '';
        
        let actionCat, actionStream;
        if (currentMode === 'live') { actionCat = 'get_live_categories'; actionStream = 'get_live_streams'; } 
        else if (currentMode === 'movie') { actionCat = 'get_vod_categories'; actionStream = 'get_vod_streams'; } 
        else if (currentMode === 'series') { actionCat = 'get_series_categories'; actionStream = 'get_series'; }

        try {
            let categoriesData;
            
            if (!isDataLoaded[currentMode]) {
                loadingDiv.textContent = "جاري تحديث البيانات...";
                const [catsRes, streamsRes] = await Promise.all([
                    fetch(`${API_URL}/player_api.php?username=${USERNAME}&password=${PASSWORD}&action=${actionCat}`),
                    fetch(`${API_URL}/player_api.php?username=${USERNAME}&password=${PASSWORD}&action=${actionStream}`)
                ]);
                
                categoriesData = await catsRes.json();
                const allData = await streamsRes.json();

                if (Array.isArray(allData)) {
                    allDataCache[currentMode] = allData;
                    let tempCounts = {};
                    allData.forEach(item => {
                        const catId = item.category_id;
                        if (tempCounts[catId]) tempCounts[catId]++;
                        else tempCounts[catId] = 1;
                    });
                    categoryCounts[currentMode] = tempCounts;
                }
                isDataLoaded[currentMode] = true;
            } else {
                const response = await fetch(`${API_URL}/player_api.php?username=${USERNAME}&password=${PASSWORD}&action=${actionCat}`);
                categoriesData = await response.json();
            }

            loadingDiv.style.display = 'none';

            if (Array.isArray(categoriesData)) {
                categoriesData.forEach(cat => {
                    const count = categoryCounts[currentMode][cat.category_id] || 0;
                    const displayName = cleanName(cat.category_name);

                    const btn = document.createElement('div');
                    btn.className = 'category-item';
                    btn.innerHTML = `
                        <div class="cat-info">
                            <span>${displayName}</span>
                            <span class="cat-count">${count}</span>
                        </div>
                    `;
                    btn.onclick = () => fetchContent(cat.category_id, displayName);
                    categoriesDiv.appendChild(btn);
                });
            }
        } catch (error) {
            console.error(error);
            loadingDiv.style.display = 'none';
            categoriesDiv.innerHTML = '<p>خطأ في الاتصال</p>';
        }
    }

    // --- عرض محتوى القسم ---
    function fetchContent(catId, catName) {
        categoriesDiv.style.display = 'none';
        contentDiv.style.display = 'flex';
        contentDiv.innerHTML = '';
        
        currentView = 'list';
        titleDiv.textContent = catName;
        lastCategoryName = catName; 
        backBtn.style.display = 'block';

        const allItems = allDataCache[currentMode];
        if (allItems && allItems.length > 0) {
            const filteredItems = allItems.filter(item => item.category_id == catId);
            if (filteredItems.length > 0) {
                filteredItems.forEach(item => createContentItem(item));
            } else {
                contentDiv.innerHTML = '<p>لا يوجد محتوى</p>';
            }
        } else {
            contentDiv.innerHTML = '<p>جاري إعادة التحميل...</p>';
            isDataLoaded[currentMode] = false;
            fetchCategories(); 
        }
    }

    // --- حلقات المسلسل ---
    async function fetchSeriesEpisodes(seriesId, seriesName) {
        contentDiv.style.display = 'none';
        episodesDiv.style.display = 'flex';
        episodesDiv.innerHTML = '';
        loadingDiv.style.display = 'block';
        loadingDiv.textContent = "جلب الحلقات...";
        
        currentView = 'episodes';
        titleDiv.textContent = cleanName(seriesName);
        backBtn.style.display = 'block'; 
        
        try {
            const url = `${API_URL}/player_api.php?username=${USERNAME}&password=${PASSWORD}&action=get_series_info&series_id=${seriesId}`;
            const response = await fetch(url);
            const data = await response.json();
            loadingDiv.style.display = 'none';

            const episodesData = data.episodes;
            
            if (episodesData && Object.keys(episodesData).length > 0) {
                for (const seasonNum in episodesData) {
                    const seasonHeader = document.createElement('div');
                    seasonHeader.className = 'season-header';
                    seasonHeader.textContent = `Season ${seasonNum}`;
                    episodesDiv.appendChild(seasonHeader);

                    episodesData[seasonNum].forEach(ep => {
                        const epDiv = document.createElement('div');
                        epDiv.className = 'episode-item';
                        
                        let epTitle = cleanName(ep.title);
                        if(epTitle.length < 2) epTitle = `Episode ${ep.episode_num}`;

                        epDiv.innerHTML = `
                            <div class="play-icon"></div>
                            <div class="episode-info">
                                <div class="episode-title">${epTitle}</div>
                                <div class="episode-meta">Ep ${ep.episode_num} • ${ep.container_extension}</div>
                            </div>
                        `;
                        epDiv.onclick = () => openPlayer(ep.id, ep.container_extension, 'series_episode');
                        episodesDiv.appendChild(epDiv);
                    });
                }
            } else {
                episodesDiv.innerHTML = '<p style="margin-top:20px;">لا توجد حلقات متاحة</p>';
            }

        } catch (error) {
            console.error(error);
            loadingDiv.style.display = 'none';
            episodesDiv.innerHTML = '<p>خطأ في جلب البيانات</p>';
        }
    }

    // --- المشغل ---
    function openPlayer(streamId, extension, forcedMode = null) {
        let streamUrl;
        const mode = forcedMode || currentMode;
        
        if (mode === 'live') {
            streamUrl = `${API_URL}/live/${USERNAME}/${PASSWORD}/${streamId}.m3u8`;
        } else if (mode === 'movie') {
            streamUrl = `${API_URL}/movie/${USERNAME}/${PASSWORD}/${streamId}.${extension || 'mp4'}`;
        } else if (mode === 'series' || mode === 'series_episode') {
            streamUrl = `${API_URL}/series/${USERNAME}/${PASSWORD}/${streamId}.${extension || 'mp4'}`;
        }

        playerOverlay.style.display = 'flex';

        if (mode === 'live' && Hls.isSupported()) {
            if (hls) hls.destroy();
            hls = new Hls();
            hls.loadSource(streamUrl);
            hls.attachMedia(videoPlayer);
            hls.on(Hls.Events.MANIFEST_PARSED, () => videoPlayer.play());
        } else {
            videoPlayer.src = streamUrl;
            videoPlayer.play();
        }
    }

    function closePlayer() {
        playerOverlay.style.display = 'none';
        videoPlayer.pause();
        videoPlayer.src = "";
        if (hls) {
            hls.destroy();
            hls = null;
        }
    }

    // بدء التشغيل
    window.onload = function() {
        applySavedMode(); // تطبيق وضع الخلفية المحفوظ
        switchMode('live');
    };

  </script>
  <script type="text/javascript" charset="utf-8">
  // JavaScript for the sidebar
    function openNav() {
        document.getElementById("mySidebar").style.width = "250px";
        document.getElementById("myOverlay").style.display = "block";
    }

    function closeNav() {
        document.getElementById("mySidebar").style.width = "0";
        document.getElementById("myOverlay").style.display = "none";
    }

  </script>
  <script type="text/javascript" charset="utf-8">
const shareButton = document.getElementById('shareButton');

// تحقق من دعم Web Share API
if (navigator.share) {
    shareButton.addEventListener('click', async () => {
        try {
            await navigator.share({
                title: 'شارك هذه الصفحة', // العنوان
                text: 'تعرف على محتوى رائع هنا!', // وصف الصفحة
                url: window.location.href, // رابط الصفحة الحالي
            });
            console.log('تمت المشاركة بنجاح!');
        } catch (error) {
            console.error('حدث خطأ أثناء المشاركة:', error);
        }
    });
} else {
    // إذا لم يكن Web Share API مدعومًا
    shareButton.disabled = true;
    shareButton.textContent = '';
}

// تحقق من دعم إشعارات المتصفح
if ("Notification" in window) {
    // تحقق من حالة الإذن الحالية
    if (Notification.permission === "default") {
        // طلب الإذن عند فتح الصفحة
        document.addEventListener("DOMContentLoaded", () => {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    // إظهار إشعار إذا وافق المستخدم
                    new Notification("شكرًا للسماح!", {
                        body: "سوف نرسل لك الإشعارات عند الحاجة.",
                        icon: "https://via.placeholder.com/100", // أيقونة الإشعار (اختياري)
                    });
                } else if (permission === "denied") {
                    console.log("تم رفض الإذن بالإشعارات.");
                }
            });
        });
    } else if (Notification.permission === "granted") {
        console.log("الإشعارات مسموح بها بالفعل.");
    } else {
        console.log("الإشعارات غير مسموح بها.");
    }
} else {
    console.log("الإشعارات غير مدعومة في هذا المتصفح.");
}
  </script>
  
</body>
</html>
